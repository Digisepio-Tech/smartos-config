#!/usr/bin/bash

## Load configuration information from USBKey
. /lib/svc/share/smf_include.sh
. /lib/sdc/config.sh

load_sdc_sysinfo
load_sdc_config

## Set the PATH environment because of other commands in /usr
PATH=/usr/bin:/usr/sbin:${PATH}

## Symlink some config files to the root user
for fullpath in /opt/custom/profile/*; do
	filename=${fullpath##*/}
	ln -nsf "${file}" "/root/.${filename}"
done

## Setup fully qualified domain name
hostname=$(hostname)
echo "${CONFIG_admin_ip}\t${hostname} ${hostname}.${CONFIG_dns_domain}" \
	>> /etc/hosts

## Sendmail configuration for SmartHost setup
cp /etc/mail/submit.cf /tmp/
sed "s:^DS:DS[${CONFIG_mail_smarthost}]:g" /tmp/submit.cf > /etc/mail/submit.cf
echo 'AuthInfo:'${CONFIG_mail_smarthost}'
	"U:'${CONFIG_mail_auth_user}'"
	"I:'${CONFIG_mail_auth_user}'"
	"P:'${CONFIG_mail_auth_pass}'"' \
	> /etc/mail/default-auth-info

## Redirect all root emails to admin address
echo "root: ${CONFIG_mail_adminaddr}" >> /etc/mail/aliases

newaliases
svcadm refresh sendmail

exit $SMF_EXIT_OK
